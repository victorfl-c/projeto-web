<!DOCTYPE html>
<html lang="pt_br">
    <head>
        <title>Ser além</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
        
        
    </head>
    <body>
        <!--Topo da página-->
        <header>
            <div class="p-5 bg-primary text-white text-center">
                <h1>Ser Além</h1>
                <p>O modo mais rápido de aprimorar ainda mais o conhecimento dos seus alunos!</p> 
            </div>
        </header>

        <main>
            <section>
                <div class="row mt-3 mx-2">
            
                    <div class="col-sm-12 border border-2">
                        
                        <div class="d-flex align-items-center justify-content-between mt-3 mb-3">    
                            <h3 class="mt-2">Suas Escolas</h3>
                           
                            <div><!--Adicionar Escola-->
                                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalCriarEscola">
                                  +
                                </button>
                            </div>
                        </div>
                        
                        <!--Sessão Escolas e Turmas-->
                        <div id="Escolas" class="border border-1">
                            
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Modal - Criar escola -->
        <div class="modal" id="modalCriarEscola">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
        
                    
                    <div class="modal-header">
                    <h4 class="modal-title">Crie uma nova escola</h4>
                    </div>
        
                    
                    <div class="modal-body">
                        <form action="" id="formCriarEscola" name="formCriarEscola" >
                                <div class="mb-3 mt-2">
                                    <label for="nomeEscola" class="form-label">Nome da escola:</label>
                                    <input type="text" class="form-control" id="nomeEscola" name="nomeEscola" placeholder="Digite o nome da escola">
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-success" onclick="cadastrarEscola()">Criar</button>
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                                </div>
                        </form>
                    </div>
                    
        
                </div>
            </div>
        </div>

        <!-- Modal - Editar Escola -->
        <div class="modal" id="modalEditScol">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <!--Header-->
                    <div class="modal-header">
                    <h4 class="modal-title">Crie uma nova escola</h4>
                    </div>
                    <!--Body-->
                    <div class="modal-body">
                        <form id="formEditScol" name="formEditScol">
                            <input type="hidden" class="form-control" id="idescola"  name="idescola">
                                <div class="mb-3 mt-2">
                                    <label for="nomeEscola" class="form-label">Editar nome da escola:</label>
                                    <input type="text" class="form-control" id="alterarEscola" name="alterarEscola" placeholder="Digite o novo nome da escola">
                                </div>
                                <!--Footer-->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-success" onclick="alterarEscola()" >Salvar</button>
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                                </div>
                        </form>
                    </div>     
                </div>
            </div>
        </div>
   
        <!-- Modal - Criar Turma -->
        <div class="modal" id="modalCriarTurma">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
        
                    <!-- Modal Header -->
                    <div class="modal-header">
                    <h4 class="modal-title">Crie uma nova turma</h4>
                    </div>
        
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form action="" id="formCriarTurm" name="formCriaTurm">
                                <div class="mb-3 mt-2">
                                    <label for="nomeDaTurma" class="form-label">Nome da turma:</label>
                                    <input type="text" class="form-control mb-2" id="nomeDaTurma" name="nomeDaTurma" placeholder="Digite o nome da escola"  required>
                                </div>

                                <div class="mb-3 mt-2">
                                    <label for="discpTurma" class="form-label">Disciplina:</label>
                                    <input type="text" class="form-control" id="discpTurma" name="discpTurma" placeholder="Digite a disciplina da turma" required>
                                </div>

                                
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-success" onclick="cadastrarTurma()">Criar</button>
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                                </div>
                        </form>
                    </div>
                    
        
                </div>
            </div>
        </div>

        <!-- Modal - Editar Turma -->
        <div class="modal" id="modalEditTurma">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
        
                    <!-- Modal Header -->
                    <div class="modal-header">
                    <h4 class="modal-title">Edite sua turma</h4>
                    </div>
        
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form action="">
                                <input type="hidden" class="form-control" id="idturma"  name="idturma">
                                <div class="mb-3 mt-2">
                                    <label for="nomeDaTurma" class="form-label">Novo nome da turma:</label>
                                    <input type="text" class="form-control mb-2" id="alterarTurma" name="alterarTurma" placeholder="Informe o novo nome da turma"  required>
                                </div>

                                <div class="mb-3 mt-2">
                                    <label for="discpTurma" class="form-label">Disciplina:</label>
                                    <input type="text" class="form-control" id="alterarDiscpTurma" name="alterarDiscpTurma" placeholder="Informe a nova disciplina" required>
                                </div>

                                
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-success" onclick="alterarTurma()">Salvar</a>
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                                </div>
                        </form>
                    </div>
                    
                </div>
            </div>
        </div>

        <!--CHAMADAS FRONT-END para o BACKEND-->
        <script>
            let listaEscola;
            let listaTurmas
           
            function cadastrarEscola(){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    alert("Sua escola foi criada com sucesso");
                    listarEscola();
                }
                xhttp.open("POST", "http://localhost:8080/cadastrarEscola");
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send(
                  JSON.stringify(
                    {
                      nomeEscola:document.getElementById('nomeEscola').value 
                    }
                  )
                );
            }

            function cadastrarTurma(){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    alert("Sua turma foi criada com sucesso!");
                    listarTurma();
                }
                xhttp.open("POST", "http://localhost:8080/cadastrarTurma");
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send(
                  JSON.stringify(
                    {
                      nomeDaTurma:document.getElementById('nomeDaTurma').value,
                      discpTurma:document.getElementById('discpTurma').value  
                    }
                  )
                );
            }
            
            function alterarEscola(){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    alert("Sua escola foi alterada com sucesso!");
                    listarEscola();
                }
                xhttp.open("PUT", "http://localhost:8080/atualizarEscola/"+document.getElementById('idescola').value);
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send(JSON.stringify({nomeEscola:document.getElementById('alterarEscola').value}));
            }

            function alterarTurma(){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    alert("Sua escola foi alterada com sucesso!");
                    listarTurma();
                }
                xhttp.open("PUT", "http://localhost:8080/atualizarTurma/"+document.getElementById('idturma').value);
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send(JSON.stringify({nomeDaTurma:document.getElementById('alterarTurma').value, discpTurma:document.getElementById('alterarDiscpTurma').value}));
            }
           
            function mostrarTelaAlterarEscola(idEscola){
            
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    const obj = JSON.parse(this.responseText);
                    document.getElementById('nomeAlterar').value = obj.nomeEscola;
                    document.getElementById('idescola').value = obj.idEscola;
                    var modalEditScol = new bootstrap.Modal(document.getElementById('modalEditScol'), {
                        keyboard: false
                    });
                    modalEditScol.show()
                }
                xhttp.open("GET", "http://localhost:8080/getEscola/"+idEscola);
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send();
            }

            function mostrarTelaAlterarTurma(idTurma){
            
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    const obj = JSON.parse(this.responseText);
                    document.getElementById('alterarTurma').value = obj.nomeDaTurma;
                    document.getElementById('alterarDiscpTurma').value = obj.discpTurma;
                    document.getElementById('idturma').value = obj.idTurma;
                    var modalEditTurma = new bootstrap.Modal(document.getElementById('modalEditTurma'), {
                        keyboard: false
                    });
                    modalEditTurma.show()
                }
                xhttp.open("GET", "http://localhost:8080/getTurma/"+idTurma);
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send();
            }

            function removerEscola(idEscola){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    alert("Sua escola foi removida com sucesso");
                    listarEscola();
                }
                xhttp.open("DELETE", "http://localhost:8080/removerEscola/"+idEscola);
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send();
            }

            function removerTurma(idTurma){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    alert("Sua turma foi removida com sucesso");
                    listarTurma();
                }
                xhttp.open("DELETE", "http://localhost:8080/removerTurma/"+idTurma);
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send();
            }

            function listarEscola(){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    const obj = JSON.parse(this.responseText);
                    listaEscola = obj;
                    
                    var divEscola = '';
                    for (let index = 0; index < obj.length; index++) {
                        const element = obj[index];
                        divEscola = divEscola +'<div class="Escola-'+element.idEscola+' d-md-flex align-items-md-center mt-2 mb-2">';
                        divEscola = divEscola +'<div class="col-sm-9 ms-2 me-5 border border-primary rounded">';
                        divEscola = divEscola +'<div  class="col-12 bg-primary text-center text-white p-2">';
                        divEscola = divEscola +'<span>'+element.nomeEscola+'</span></div>';
                        divEscola = divEscola +'<div class="turmasDaEscola">';
                        divEscola = divEscola +'<h5 class="mt-3 mb-3 ms-3">Suas turmas:</h5>';
                        divEscola = divEscola +'<div class="d-flex align-items-center justify-content-center mb-3 mt-4">';
                        divEscola = divEscola +'<button type="button" class="col-md-5 btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalCriarTurma">Adicionar nova turma</button></div>';
                        divEscola = divEscola +'</div>';
                        divEscola = divEscola +'<button type="button" class="col-md-1 me-2 btn btn-warning btn-sm" onclick="mostrarTelaAlterarEscola('+element.idEscola+');">Editar</button>';
                        divEscola = divEscola +'<button type="button" class="col-md-1 btn btn-danger btn-sm" onclick="removerEscola('+element.idEscola+');">Excluir</button></div>';
                        divEscola = divEscola +'</div>';
                    }
                    
                    document.getElementById("Escolas").innerHTML = divEscola;
                }
                xhttp.open("GET", "http://localhost:8080/listarEscola");
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send();
            }

            function listarTurma(idEscola){
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    const obj = JSON.parse(this.responseText);
                    listaTurmas = obj;
                    
                    //Determinar que o botão adicionar-turma chame da Escola(ID) correto
                    var btnAddTurm = document.getElementById("addTurma");
                    btnAdTurmas.onclick = () => {
                        idEsclClicada = `Escola-${idEscola}`
                    }
                    
                    //Analisar se a div-Turmas existe, caso não, criará.
                    var divPaiTurmas = document.querySelector(`.${idEsclClicada} .paiTurmas`);
                    if (divPaiTurmas === null) {
                        divPaiTurmas = document.createElement('div');
                        divPaiTurmas.classList.add(".paiTurmas");
                        document.querySelector(`.${idEsclClicada} .turmasDaEscola`)
                        .insertBefore(divPaiTurmas, document.querySelector(`.${idEsclClicada} .turmasDaEscola`).firstChild.nextSibling);
                    }


                    var turmas = '';
                    turmas = turmas + '<div class="turmas">';
                    for (let index = 0; index < obj.length; index++) {
                        const element = obj[index];
                        turmas = turmas +'<div class="Turma mb-3">';
                        turmas = turmas +'<a href="" class="col-md-9 btn btn-outline-secondary ms-2 p-2 text-start">';
                        turmas = turmas +'<span>'+element.nomeDaTurma+'</span></a>';
                        turmas = turmas +'<button type="button" class="col-md-1 btn btn-warning btn-sm ms-4" onclick="mostrarTelaAlterarTurma('+element.idTurma+');">Alterar</button>';
                        turmas = turmas +'<button type="button" class="col-md-1 btn btn-danger btn-sm" onclick="removerTurmas('+element.idTurma+');">Excluir</button></div>';
                    }
                    
                    turmas = turmas + '</div>';
                    document.getElementsByClassName("paiTurmas").innerHTML = turmas;
                }
                xhttp.open("GET", "http://localhost:8080/listarTurma");
                xhttp.setRequestHeader("Content-Type", "application/json");
                xhttp.send();
            }
        </script>
        
    </body>
    
</html>